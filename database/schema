-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.districts_enum
(
    id serial NOT NULL,
    geom geometry(MultiPolygon,4326),
    "EACODE" numeric,
    "TA" character varying(254) COLLATE pg_catalog."default",
    "TA_CODE" numeric,
    "DISTRICT" character varying(254) COLLATE pg_catalog."default",
    "DIST_CODE" numeric,
    "PCODE3" character varying(254) COLLATE pg_catalog."default",
    "TA3_name" character varying(254) COLLATE pg_catalog."default",
    filter bigint,
    "filter_TA" bigint,
    filter_dis bigint,
    "filter_GVH" bigint,
    population numeric,
    poverty numeric,
    drought_sc numeric,
    flood_sc numeric,
    tt_hospita bigint,
    tt_secshoo bigint,
    tt_tradcen bigint,
    pov_score numeric,
    tt_hos_sco numeric,
    tt_ss_sco numeric,
    tt_tc_sco numeric,
    vul_score numeric,
    haz_score numeric,
    cope_score numeric,
    risk_score numeric,
    CONSTRAINT districts_enum_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.flood_events
(
    id serial NOT NULL,
    name character varying(255) COLLATE pg_catalog."default",
    start_date timestamp without time zone,
    end_date timestamp without time zone,
    geom geometry(MultiPolygon,4326),
    source character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT flood_events_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.flood_reports
(
    id serial NOT NULL,
    user_id integer,
    description text COLLATE pg_catalog."default",
    severity integer,
    image_url text COLLATE pg_catalog."default",
    geom geometry(Point,4326) NOT NULL,
    "timestamp" timestamp without time zone DEFAULT now(),
    CONSTRAINT flood_reports_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.mitigation_priorities
(
    id serial NOT NULL,
    risk_zone_id integer,
    score double precision,
    notes text COLLATE pg_catalog."default",
    CONSTRAINT mitigation_priorities_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.r2pg_log
(
    log character varying COLLATE pg_catalog."default"
);

CREATE TABLE IF NOT EXISTS public.rainfall_data
(
    id serial NOT NULL,
    "timestamp" timestamp without time zone NOT NULL,
    raster raster,
    mean_value double precision,
    CONSTRAINT rainfall_data_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.risk_zones
(
    id serial NOT NULL,
    level character varying(50) COLLATE pg_catalog."default",
    geom geometry(Polygon,4326),
    calculated_at timestamp without time zone DEFAULT now(),
    CONSTRAINT risk_zones_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.rivers
(
    id serial NOT NULL,
    geom geometry(MultiLineString,4326),
    name character varying(80) COLLATE pg_catalog."default",
    name_en character varying(80) COLLATE pg_catalog."default",
    waterway character varying(80) COLLATE pg_catalog."default",
    covered character varying(80) COLLATE pg_catalog."default",
    width character varying(80) COLLATE pg_catalog."default",
    depth character varying(80) COLLATE pg_catalog."default",
    layer character varying(80) COLLATE pg_catalog."default",
    blockage character varying(80) COLLATE pg_catalog."default",
    tunnel character varying(80) COLLATE pg_catalog."default",
    "natural" character varying(80) COLLATE pg_catalog."default",
    water character varying(80) COLLATE pg_catalog."default",
    source character varying(80) COLLATE pg_catalog."default",
    name_ny character varying(80) COLLATE pg_catalog."default",
    osm_id bigint,
    osm_type character varying(80) COLLATE pg_catalog."default",
    CONSTRAINT rivers_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.roads
(
    id serial NOT NULL,
    geom geometry(MultiLineString,4326),
    name character varying(80) COLLATE pg_catalog."default",
    name_en character varying(80) COLLATE pg_catalog."default",
    highway character varying(80) COLLATE pg_catalog."default",
    surface character varying(80) COLLATE pg_catalog."default",
    smoothness character varying(80) COLLATE pg_catalog."default",
    width character varying(80) COLLATE pg_catalog."default",
    lanes character varying(80) COLLATE pg_catalog."default",
    oneway character varying(80) COLLATE pg_catalog."default",
    bridge character varying(80) COLLATE pg_catalog."default",
    layer character varying(80) COLLATE pg_catalog."default",
    source character varying(80) COLLATE pg_catalog."default",
    name_ny character varying(80) COLLATE pg_catalog."default",
    osm_id bigint,
    osm_type character varying(80) COLLATE pg_catalog."default",
    CONSTRAINT roads_pkey PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.users
(
    id serial NOT NULL,
    name character varying(255) COLLATE pg_catalog."default" NOT NULL,
    email character varying(255) COLLATE pg_catalog."default" NOT NULL,
    password_hash text COLLATE pg_catalog."default" NOT NULL,
    role character varying(50) COLLATE pg_catalog."default" DEFAULT 'user'::character varying,
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT users_pkey PRIMARY KEY (id),
    CONSTRAINT users_email_key UNIQUE (email)
);

ALTER TABLE IF EXISTS public.flood_reports
    ADD CONSTRAINT flood_reports_user_id_fkey FOREIGN KEY (user_id)
    REFERENCES public.users (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public.mitigation_priorities
    ADD CONSTRAINT mitigation_priorities_risk_zone_id_fkey FOREIGN KEY (risk_zone_id)
    REFERENCES public.risk_zones (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;

END;